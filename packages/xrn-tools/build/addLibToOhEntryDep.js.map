{"version":3,"file":"addLibToOhEntryDep.js","sourceRoot":"","sources":["../src/addLibToOhEntryDep.ts"],"names":[],"mappings":";;;;;;AAAA,wDAA0B;AAC1B,kDAA0B;AAC1B,gDAAwB;AAExB,2CAAsC;AAEtC,mCAA+C;AAExC,MAAM,qBAAqB,GAAG,KAAK,EAAE,EAC1C,WAAW,EACX,iBAAiB,EACjB,UAAU,GACS,EAAE,EAAE;IACvB,MAAM,SAAS,GAAG,cAAI,CAAC,IAAI,CAAC,mBAAO,EAAE,YAAY,CAAC,CAAC;IACnD,MAAM,uBAAuB,GAAG,cAAI,CAAC,IAAI,CACvC,SAAS,EACT,SAAS,EACT,qBAAqB,CACtB,CAAC;IAEF,MAAM,mBAAmB,GAAG,kBAAE,CAAC,YAAY,CAAC,uBAAuB,EAAE,OAAO,CAAC,CAAC;IAC9E,MAAM,YAAY,GAAG,eAAK,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAAC;IACtD,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC;QACxB,IAAI,EAAE,iBAAiB;QACvB,OAAO,EAAE,qBAAqB,WAAW,YAAY,iBAAiB,EAAE;KACzE,CAAC,CAAC;IAEH,kBAAE,CAAC,aAAa,CACd,uBAAuB,EACvB,eAAK,CAAC,SAAS,CAAC,YAAY,EAAE,IAAI,EAAE,CAAC,CAAC,CACvC,CAAC;IAEF,OAAO,CAAC,GAAG,CACT,eAAe,iBAAiB,oCAAoC,CACrE,CAAC;AACJ,CAAC,CAAC;AA3BW,QAAA,qBAAqB,yBA2BhC;AAEK,MAAM,kBAAkB,GAAG,KAAK,EAAE,EACvC,WAAW,EACX,iBAAiB,EACjB,UAAU,GACS,EAAE,EAAE;IACvB,MAAM,WAAW,GAAG,MAAM,IAAA,4BAAoB,EAAC,WAAW,CAAC,CAAC;IAC5D,IAAI,CAAC,WAAW,EAAE,CAAC;QACjB,OAAO,CAAC,KAAK,CAAC,WAAW,WAAW,yBAAyB,CAAC,CAAC;QAC/D,OAAO;IACT,CAAC;IACD,MAAM,SAAS,GAAG,cAAI,CAAC,IAAI,CAAC,mBAAO,EAAE,YAAY,CAAC,CAAC;IACnD,MAAM,kBAAkB,GAAG,cAAI,CAAC,IAAI,CAClC,SAAS,EACT,SAAS,EACT,OAAO,EACP,kBAAkB,CACnB,CAAC;IAEF,MAAM,YAAY,GAAG,kBAAE,CAAC,YAAY,CAAC,kBAAkB,EAAE,OAAO,CAAC,CAAC;IAClE,MAAM,SAAS,GAAG,eAAK,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;IAE5C,IAAI,UAAU,EAAE,CAAC;QACf,OAAO;QACP,SAAS,CAAC,YAAY,CAAC,WAAW,CAAC;YACjC,wBAAwB,WAAW,YAAY,iBAAiB,EAAE,CAAC;IACvE,CAAC;SAAM,CAAC;QACN,SAAS,CAAC,YAAY,CAAC,WAAW,CAAC;YACjC,sBAAsB,WAAW,YAAY,iBAAiB,MAAM,CAAC;IACzE,CAAC;IAED,kBAAE,CAAC,aAAa,CAAC,kBAAkB,EAAE,eAAK,CAAC,SAAS,CAAC,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC;IAE1E,IAAA,6BAAqB,EAAC,EAAE,WAAW,EAAE,iBAAiB,EAAE,UAAU,EAAE,CAAC,CAAC;AACxE,CAAC,CAAC;AAjCW,QAAA,kBAAkB,sBAiC7B","sourcesContent":["import fs from \"fs-extra\";\nimport json5 from \"json5\";\nimport path from \"path\";\n\nimport { XRN_DIR } from \"./Constants\";\nimport { AddLibToOhEntryDep } from \"./types\";\nimport { findWorkspacePackage } from \"./utils\";\n\nexport const addModuleToOhEntryDep = async ({\n  packageName,\n  harmonyModuleName,\n  sourceCode,\n}: AddLibToOhEntryDep) => {\n  const xrngoPath = path.join(XRN_DIR, \"apps/xrngo\");\n  const harmonyBuildProfilePath = path.join(\n    xrngoPath,\n    \"harmony\",\n    \"build-profile.json5\"\n  );\n\n  const buildProfileContent = fs.readFileSync(harmonyBuildProfilePath, \"utf-8\");\n  const buildProfile = json5.parse(buildProfileContent);\n  buildProfile.modules.push({\n    name: harmonyModuleName,\n    srcPath: `../../../packages/${packageName}/harmony/${harmonyModuleName}`,\n  });\n\n  fs.writeFileSync(\n    harmonyBuildProfilePath,\n    json5.stringify(buildProfile, null, 2)\n  );\n\n  console.log(\n    `Harmony lib ${harmonyModuleName} added to xrngo entry dependencies`\n  );\n};\n\nexport const addLibToOhEntryDep = async ({\n  packageName,\n  harmonyModuleName,\n  sourceCode,\n}: AddLibToOhEntryDep) => {\n  const packageInfo = await findWorkspacePackage(packageName);\n  if (!packageInfo) {\n    console.error(`Package ${packageName} not found in workspace`);\n    return;\n  }\n  const xrngoPath = path.join(XRN_DIR, \"apps/xrngo\");\n  const entryOhPackagePath = path.join(\n    xrngoPath,\n    \"harmony\",\n    \"entry\",\n    \"oh-package.json5\"\n  );\n\n  const json5Content = fs.readFileSync(entryOhPackagePath, \"utf-8\");\n  const ohPackage = json5.parse(json5Content);\n\n  if (sourceCode) {\n    // 源码调试\n    ohPackage.dependencies[packageName] =\n      `../../../../packages/${packageName}/harmony/${harmonyModuleName}`;\n  } else {\n    ohPackage.dependencies[packageName] =\n      `../../node_modules/${packageName}/harmony/${harmonyModuleName}.har`;\n  }\n\n  fs.writeFileSync(entryOhPackagePath, json5.stringify(ohPackage, null, 2));\n\n  addModuleToOhEntryDep({ packageName, harmonyModuleName, sourceCode });\n};\n"]}